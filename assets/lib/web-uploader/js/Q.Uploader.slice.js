//devin87@qq.com
//build:2018/02/09 11:03:32
!function(e,n){"use strict";var t=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=Q.Uploader;i.extend({_upload_slice:function(e){var n,o=this,a=e.blob||e.file,r=a.size,l=o.chunkSize,c=e.sliceStart||0;e.sliceCount=Math.ceil(r/l);var s=function(){c>=r||((n=c+l)>r&&(n=r),e.sliceStart=c,e.sliceEnd=n,e.sliceIndex=Math.ceil(n/l),e.sliceBlob=t.call(a,c,n),o.fire("sliceUpload",e,function(t){if(!1===t)return p();!function(t,a){var l=new XMLHttpRequest,s=e.url,p=n==r;e.xhr=l,s+=(-1==s.indexOf("?")?"?":"&")+"action=upload&hash="+(e.hash||e.name)+"&ok="+(p?"1":"0"),l.upload.addEventListener("progress",function(n){o.progress(e,r,c+n.loaded)},!1),l.addEventListener("load",function(n){p&&o.complete(e,i.COMPLETE,n.target.responseText),a()},!1),l.addEventListener("error",function(){o.complete(e,i.ERROR)},!1);var d=new FormData;p&&(o._process_params(e,function(e,n){d.append(e,n)}),d.append("fileName",e.name)),d.append(o.upName,t,e.name),l.open("POST",s),p?o.fire("send",e,function(n){if(!1===n)return o.complete(e,i.SKIP);l.send(d)}):l.send(d)}(e.sliceBlob,p)}))},p=function(){c=n,s()};s(),o._afterSend(e)}})}(window);