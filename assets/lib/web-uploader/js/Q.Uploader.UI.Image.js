//devin87@qq.com
//build:2017/08/23 11:31:57
!function(e,t){"use strict";function i(e,t){e.className+=" "+t}function a(e,t){e&&(e.innerHTML=t||"")}function r(t,i){var a=e.URL||e.webkitURL;if(a)return i(a.createObjectURL(t));if(e.FileReader){var r=new FileReader;r.onload=function(e){i(e.target.result)},r.readAsDataURL(t)}else t.readAsDataURL&&i(t.readAsDataURL())}function n(e,i,a){var n=i.input,o=i.file||(n.files?n.files[0]:t);if(o)r(o,function(t){t&&(e.innerHTML='<img src="'+t+'" />'),a&&a(t)});else if(n){var s=n.value;if(s&&!/^\w:\\fakepath/.test(s)||(n.select(),parent.document.body.focus(),document.selection&&(s=document.selection.createRange().text)),s){e.innerHTML='<img src="'+s+'" />';try{g>6&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+s+"')")}catch(l){}}a&&a(s)}}function o(e){var t=e.slice(1);return"image/"+("jpg"==t?"jpeg":t)}function s(e,t){for(var i=e.split(","),a=atob(i[1]),r=[],n=0,o=a.length;o>n;n++)r[n]=a.charCodeAt(n);if(v)return new v([new Uint8Array(r)],{type:t});var s=new h;return s.append(r),s.getBlob(t)}function l(e,t,i,a){var r=new Image;r.src=e,r.onload=function(){var e=r.width,n=r.height,o=i.maxWidth,s=i.maxHeight,l=o&&e>o,c=s&&n>s,u=l||c;if(!u)return a&&a(!1);l&&(e=o,n=Math.floor(r.height*e/r.width)),c&&(n=s,e=Math.floor(r.width*n/r.height));var d=document.createElement("canvas"),f=d.getContext("2d");d.width=e,d.height=n,f.drawImage(r,0,0,e,n),a&&a(d.toDataURL(t),t)}}var c=Q.getFirst,u=Q.getNext,d=Q.createEle,f=Q.setOpacity,g=Q.ie,p=Q.Uploader,v=e.Blob||e.WebkitBlob||e.MozBlob,h=e.WebKitBlobBuilder||e.MozBlobBuilder,m=function(){if(!e.FileReader||!e.atob||!v&&!h)return!1;var t=document.createElement("canvas");return!!t.getContext&&!!t.getContext("2d")}(),b=".jpg,.png,.gif,.bmp,.webp,.tif,.tiff",w=".jpg";p.support.imageScale=m,p.previewImage=n,p.scaleImage=l,p.UI.Image={init:function(){var e=this.ops,t=e.view;e.allows||(e.allows=b),t&&i(t,"ui-image "+(this.html5?"html5":"html4"))},supportScale:function(e){if(!m)return!1;".jpeg"==e&&(e=".jpg");var t=(this.ops.scale||{}).types||w,i=-1!=b.indexOf(e);return i?"*"==t||-1!=t.indexOf(e):!1},previewImage:function(e,t,i){var a=this,r=t.scale||i.scale,c=r&&a.supportScale(t.ext);return c&&(t.skip=!0),n(e,t,function(e){a.fire("preview",{task:t,src:e}),e&&c&&l(e,o(t.ext),r,function(e,i){if(e){var r=s(e,i);t.blob=r,a.fire("scale",{task:t,base64:e,type:i,blob:r})}t.skip=!1,a.list.push(t),a.auto&&a.start()})}),a},draw:function(e){var t=this,i=t.ops,a=i.view;if(a){var r=e.name,n='<div class="u-img"></div><div class="u-progress-bar"><div class="u-progress"></div></div><div class="u-detail"></div><div class="u-name" title="'+r+'">'+r+"</div>",o=e.id,s=d("div","u-item",n);s.taskId=o;var l=c(s),g=u(l),p=c(g),v=u(g);f(g,.3),f(p,.5),e.box=s,e.boxProgress=p,e.boxDetail=v,a.appendChild(s),t.previewImage(l,e,i).update(e)}},update:function(e){if(e&&e.box){var i=this,r=e.total||e.size,n=e.loaded,o=e.state,s=e.boxProgress,l=e.boxDetail,c=p.getStatusText(o);if(i.html5&&n!=t&&n>=0){var u;if(o==p.PROCESSING){var d=Math.min(100*n/r,100);u=d.toFixed(1),"100.0"==u&&(u="99.9")}else o==p.COMPLETE&&(u="100");u&&(u+="%",c+=" "+u,s.style.width=u)}a(l,c)}},over:function(e){e&&e.box&&i(e.box,"u-over")}},p.extend(p.UI.Image)}(window);